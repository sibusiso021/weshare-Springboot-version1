<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{/layout.html}">
<head></head>
<body>
<div layout:fragment="contents">
    <section class="expenseList">
        <h2>Submit a payment request for the following expense</h2>
        <div th:each="expense: ${paymentrequests}">
            <table>

                <tr>
                    <td>Date</td>
                    <td id="expense_date" th:text="${expense.get().date}">amount</td>
                </tr>
                <tr>
                    <td>Description</td>
                    <td id="expense_description" th:text="${expense.get().description}">description</td>
                </tr>
                <tr>
                    <td>Amount</td>
                    <td id="expense_amount" th:text="${expense.get().amount}"></td>
                </tr>

            </table>

            <div id="expenses" th:unless="${#lists.isEmpty(paymentrequests.get().listOfPaymentRequests())}">
               <h1> Previous Payment Requests for this expense </h1>
                <table>
                    <thead>
                        <tr>
                            <th>Who</th>
                            <th>Due</th>
                            <th>Paid</th>
                            <th>How Much</th>

                        </tr>

                    </thead>
                    <tbody th:each=" tobepaid :${paymentrequests.get().listOfPaymentRequests()}">
                    <tr>
                        <td th:id="'paymentrequest_who_' +${tobepaid.id}" th:text="${tobepaid.personWhoShouldPayBack.getName()}"></td>
                        <td th:id="'paymentrequest_date_' +${tobepaid.id}" th:text="${tobepaid.dueDate}"></td>
                        <td  th:id="'paymentrequest_paid_' +${tobepaid.id}" th:text="${tobepaid.isPaid()} ? 'Yes' : 'No'"></td>
                        <td th:id="'paymentrequest_amount_' +${tobepaid.id}" th:text="${tobepaid.amountToPay}"></td>
                    </tr>

                    </tbody>
                    <tfoot>

                    <td colspan="5">Total Amount of Payments Requested</td>
                    <td id="grand_total" th:text="${total}"></td>

                    </tfoot>
                </table>
            </div>


            <div>
                <form method="post" action="/paymentrequest.action" enctype="application/x-www-form-urlencoded">
                    <label for="email">The email address of the person that should pay you</label>
                    <input name="email" id="email" type="email" required>
                    <label for="amount">The amount you should pay (Maximum <span th:text="${expense.get().amountLessPaymentsReceived()}"></span>!)</label>
                    <input name="amount" id="amount" type="number" required>
                    <label for="due_date">By when must this claim be settled(dd/mm/yy)</label>
                    <input name="due_date" id="due_date" type="text" pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required>
                    <input name="id" th:id="${expense.get().id}" type="hidden" th:value="${expense.get().id}">

                    <input id="submit" type="submit" value="Submit"/>
                </form>
            </div>
        </div>
    </section>
    </div>

    </body>
